-- schema_bus.sql
-- Run as the user Java will connect with (SYSTEM or your app user)

-- Drop tables if exist (safe)
BEGIN
  EXECUTE IMMEDIATE 'DROP TABLE BOOKING';
EXCEPTION WHEN OTHERS THEN NULL;
END;
/
BEGIN
  EXECUTE IMMEDIATE 'DROP TABLE SCHEDULE';
EXCEPTION WHEN OTHERS THEN NULL;
END;
/
BEGIN
  EXECUTE IMMEDIATE 'DROP TABLE BUS';
EXCEPTION WHEN OTHERS THEN NULL;
END;
/

-- BUS table
CREATE TABLE BUS (
  BUS_ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
  BUS_NAME VARCHAR2(200),
  TOTAL_SEATS NUMBER,
  PRIMARY KEY (BUS_ID)
);

-- SCHEDULE table (each schedule is a bus running on a route/time)
CREATE TABLE SCHEDULE (
  SCHEDULE_ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
  BUS_ID NUMBER,
  SOURCE VARCHAR2(100),
  DESTINATION VARCHAR2(100),
  DEPARTURE_TIME VARCHAR2(50),
  FARE NUMBER,
  PRIMARY KEY (SCHEDULE_ID),
  FOREIGN KEY (BUS_ID) REFERENCES BUS(BUS_ID)
);

-- BOOKING table
CREATE TABLE BOOKING (
  BOOKING_ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
  SCHEDULE_ID NUMBER,
  CUSTOMER_NAME VARCHAR2(200),
  CUSTOMER_EMAIL VARCHAR2(200),
  SEATS_BOOKED NUMBER,
  BOOKED_AT TIMESTAMP DEFAULT SYSTIMESTAMP,
  PRIMARY KEY (BOOKING_ID),
  FOREIGN KEY (SCHEDULE_ID) REFERENCES SCHEDULE(SCHEDULE_ID)
);

-- sample data
INSERT INTO BUS (BUS_NAME, TOTAL_SEATS) VALUES ('Express Line A', 40);
INSERT INTO BUS (BUS_NAME, TOTAL_SEATS) VALUES ('City Rider B', 30);

INSERT INTO SCHEDULE (BUS_ID, SOURCE, DESTINATION, DEPARTURE_TIME, FARE)
VALUES (1, 'CityX', 'CityY', '08:00 AM', 350);

INSERT INTO SCHEDULE (BUS_ID, SOURCE, DESTINATION, DEPARTURE_TIME, FARE)
VALUES (1, 'CityX', 'CityZ', '02:00 PM', 400);

INSERT INTO SCHEDULE (BUS_ID, SOURCE, DESTINATION, DEPARTURE_TIME, FARE)
VALUES (2, 'CityY', 'CityZ', '09:30 AM', 250);

COMMIT;
